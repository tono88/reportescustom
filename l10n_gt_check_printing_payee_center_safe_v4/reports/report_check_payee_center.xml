<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <template id="report_check_payee_center_inherit"
            name="Cheque GT - Payee + fecha + monto desplazados 20mm; centavos inline (v4)"
            inherit_id="l10n_gt_check_printing.report_check">

    <!-- 1) Mover FECHA 20mm a la derecha -->
    <xpath expr="//div[contains(@class,'chk-date')]" position="attributes">
      <attribute name="style" add="margin-left:20mm;" separator=" "/>
    </xpath>

    <!-- 2) Beneficiario (payee), alineado a la izquierda y corrido 20mm (18mm + 20mm = 38mm) -->
    <xpath expr="//div[contains(@class,'chk-amount-text')]" position="before">
      <div class="chk-payee"
           t-attf-style="position:absolute; top:19mm; left:38mm; width:120mm;
                         text-align:left; font-weight:700;">
        <t t-esc="(p.partner_id.name or '').upper()"/>
      </div>
    </xpath>

    <!-- 3) Reemplazar bloque MONTO EN LETRAS: +20mm y centavos en la misma línea.
            Sin 'or' en cascada ni llamadas ambiguas. -->
    <xpath expr="//div[contains(@class,'chk-amount-text')]" position="replace">
      <div class="chk-amount-text"
           t-attf-style="position:absolute; top:32mm; left:38mm; width:120mm; text-align:left;">

        <!-- Monto base: probar p.amount y si no, p.amount_total -->
        <t t-set="amt" t-value="getattr(p, 'amount', None)"/>
        <t t-if="amt is None">
          <t t-set="amt" t-value="getattr(p, 'amount_total', 0.0)"/>
        </t>

        <!-- Idioma -->
        <t t-set="lang_code" t-value="(p.partner_id.lang or 'es_GT') if p else 'es_GT'"/>

        <!-- Texto en letras con prioridad a p.currency_id y fallback a company_id.currency_id -->
        <t t-set="words" t-value="''"/>
        <t t-if="p and p.currency_id">
          <t t-set="words" t-value="p.currency_id.amount_to_text(amt or 0.0, lang=lang_code)"/>
        </t>
        <t t-if="not words and p and p.company_id and p.company_id.currency_id">
          <t t-set="words" t-value="p.company_id.currency_id.amount_to_text(amt or 0.0, lang=lang_code)"/>
        </t>

        <!-- Centavos seguros -->
        <t t-set="amt100" t-value="int(round((amt or 0.0) * 100))"/>
        <t t-set="cents_val" t-value="amt100 % 100"/>
        <t t-set="cent_str" t-value="('%02d' % cents_val)"/>

        <!-- Una sola línea: PALABRAS + ' ' + CC/100 -->
        <span t-esc="words"/><span>&#160;</span><span t-esc="cent_str"/>/100
      </div>
    </xpath>
  </template>
</odoo>
