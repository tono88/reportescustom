<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Acción de reporte -->
  <record id="action_report_check_gt" model="ir.actions.report">
    <field name="name">Cheque Guatemala</field>
    <field name="model">account.payment</field>
    <field name="report_type">qweb-pdf</field>
    <field name="report_name">l10n_gt_check_printing.report_check</field>
    <field name="print_report_name">'Cheque - %s' % (object.name or '')</field>
    <field name="paperformat_id" ref="l10n_gt_check_printing.paperformat_check_letter"/>
  </record>

  <!-- TEMPLATE BASE -->
  <template id="report_check">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="p">

        <!-- Variables auxiliares para el monto -->
        <t t-set="amount" t-value="p.amount or 0.0"/>
        <t t-set="integer" t-value="int(amount)"/>
        <t t-set="cents"   t-value="int(round((amount - integer) * 100))"/>

        <div id="layout_root"
             t-attf-class="oe_structure {{ (p.company_id.account_check_printing_layout or '').split('.')[-1] }}"
             t-attf-style="position:relative; width:216mm; height:90mm;
                            margin-top: {{ (p.company_id.account_check_printing_margin_top or 0.0) }}mm;
                            margin-left: {{ (p.company_id.account_check_printing_margin_left or 0.0) }}mm;
                            margin-right: {{ (p.company_id.account_check_printing_margin_right or 0.0) }}mm;">

          <!-- Línea punteada al centro (decorativa) -->
          <div class="center-dash"></div>

          <!-- FECHA: 'CIUDAD, dd/mm/YYYY' -->
          <div class="chk-date">
            <t t-esc="'PALIN'"/>
            <t t-raw="', '"/>
            <t t-esc="fmt_date(p.date)"/>
          </div>

          <!-- MONTO NUMÉRICO SIN SÍMBOLO -->
          <div class="chk-amount-num">
            <t t-esc="'%0.2f' % (p.amount or 0.0)"/>
          </div>

          <!-- ANULADO (si aplica) -->
          <div class="chk-void" t-if="is_void_payment(p)">
            ANULADO
          </div>

          <!-- BENEFICIARIO / PROVEEDOR -->
          <div class="chk-payee">
            <t t-esc="upper(p.partner_id.name)"/>
          </div>

          <!-- MONTO EN LETRAS + CENTAVOS EN LA MISMA LÍNEA -->
          <div class="chk-amount-text">
            <t t-esc="amount_words_line(p)"/>
          </div>

          <style>
            /* Tamaño del bloque principal del cheque (ajusta height si lo quieres más alto) */
            #layout_root { box-sizing: border-box; }

            /* Línea punteada central (opcional) */
            .center-dash {
              position:absolute; top:0mm; bottom:0mm; left:108mm;
              border-left: 0.4mm dashed #aaa;
            }

            /* Etiqueta ANULADO */
            .chk-void {
              position:absolute;
              top:20mm;
              left:10mm;
              font-weight:700;
              font-size:12pt;
              letter-spacing:0.3mm;
            }

            /* Posiciones (ajusta mm para calzar con tu cheque físico) */
            .chk-date        { position:absolute; top:6mm;  left:40mm;  width:95mm;  font-weight:600; }
            .chk-amount-num  { position:absolute; top:6mm;  right:10mm; width:40mm;  text-align:right; font-weight:700; }
            .chk-payee       { position:absolute; top:19mm; left:40mm;  width:120mm; text-align:left; font-weight:700; }
            .chk-amount-text { position:absolute; top:32mm; left:40mm;  width:110mm; }

            /* Desplazamientos por stub (si imprimes en top/middle/bottom) */
            .check_top    { transform: translateY(0mm); }
            .check_middle { transform: translateY(93mm); }
            .check_bottom { transform: translateY(186mm); }

            /* Quitar márgenes de página */
            @page { margin: 0mm; }
          </style>
        </div>

        <div class="page"/>
      </t>
    </t>
  </template>

  <!-- Herencias para top/middle/bottom -->
  <template id="check_top" inherit_id="l10n_gt_check_printing.report_check" name="Cheque GT - Top">
    <xpath expr="//div[@id='layout_root']" position="attributes">
      <attribute name="class">oe_structure check-top</attribute>
    </xpath>
  </template>

  <template id="check_middle" inherit_id="l10n_gt_check_printing.report_check" name="Cheque GT - Middle">
    <xpath expr="//div[@id='layout_root']" position="attributes">
      <attribute name="class">oe_structure check-middle</attribute>
    </xpath>
  </template>

  <template id="check_bottom" inherit_id="l10n_gt_check_printing.report_check" name="Cheque GT - Bottom">
    <xpath expr="//div[@id='layout_root']" position="attributes">
      <attribute name="class">oe_structure check-bottom</attribute>
    </xpath>
  </template>

</odoo>
